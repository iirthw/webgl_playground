<!DOCTYPE html>

<html>
  <head>    
    <title>WebGL Playground: Mandelbrot</title>
    <link rel="stylesheet" href="../common/css/webgl.css" type="text/css">

    <script id="vertex-shader" type="x-shader/x-vertex">      
      #version 100

      #ifdef GL_ES
        precision mediump float;
      #endif

      attribute vec4 iPosition;      

      void main()
      {
        gl_Position = iPosition;
      }
    </script>

    <script id="fragment-shader" type="x-shader/x-fragment">
      #version 100

      // number of iterations
      #define N 16

      precision mediump float;

      uniform float uScale;
      uniform vec2 uTranslation;
      uniform vec2 uScreenRes;

      vec4 color(vec2 res)
      {
          return vec4(
              gl_FragCoord.x / res.x,
              gl_FragCoord.y / res.y,
              0.1, 1.0);
      }

      float modulus_squared(vec2 v)
      {
          return 0.0;
      }

      vec4 mandelbrot()
      {
          vec2 z = vec2(0.0, 0.0);
          float centerX = 0.5- uTranslation.x;
          float centerY = 0.5 - uTranslation.y;
          vec2 c = vec2(
            uScale * (gl_FragCoord.x / uScreenRes.x) - centerX, 
            uScale * (gl_FragCoord.y / uScreenRes.y) - centerY
            );

          // specific case for the origin of the coordinate system
          const float eps = 0.01;
          if (abs(c.x) < eps && abs(c.y) < eps)
              return vec4(1.0, 0.0, 0.0, 1.0);

          for (int i = 0; i < N; ++i)
          {
              float a = z.x * z.x - z.y * z.y;
              float b = 2.0 * z.x * z.y;
              z = vec2(a, b) + c;
              if (dot(z, z) >= 4.0)
                  return vec4(0.0, 0.0, float(i) / float(N), 1.0);
          }

          return vec4(0.0, 0.0, 0.0, 1.0);
      }

      void main()
      {
          gl_FragColor = mandelbrot();
      }
    </script>

    <script type="text/javascript" src="../common/webgl_utils.js"></script>
    <script type="text/javascript" src="../common/init_shaders.js"></script>
    <script type="text/javascript" src="mandelbrot.js"></script>
  </head>
  <body>
    <canvas id="gl-canvas" width="512" height="512"></canvas>
  </body>
</html>